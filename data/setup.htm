<!DOCTYPE html>
<html>
<head>
<link rel="icon" type="image/x-icon" href="favicon.ico"/>
<link rel='stylesheet' href='https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css'>
<style>
#span {
  width: 30px;
}
#timeout {
  width: 30px;
}
#water_adjust {
  width: 30px;
}
#key {
  width: 120px;
}
#location {
  width: 90px;
}
#logging_ip_addr {
  width: 90px;
}
#logging_ip_port {
  width: 30px;
}
#log_url {
  width: 200px;
}
#rainBlackoutMultiplier {
  width: 30px;
}
#torrent_ip_addr {
  width: 90px;
}
#torrent_ip_port {
  width: 30px;
}
#torrent_delay {
  width: 30px;
}
#chip_type {
  width: 30px;
}
</style>
<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js'></script>
<script src='https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js'></script>
<script src='common.js'></script>
<script>
$(document).ready(function(){
  initGui();
  initWebsocket('setup');
});

function message(msg){
  console.log('onmessage ' + msg.data);
  var obj = JSON.parse(msg.data);
    
  $('#date').html(obj.date);
  $('#time').html(obj.time);
  $('#timeout').val(obj.timeout);
  $('#water_adjust').val(obj.water_adjust);
  $('#use_zimmerman').prop('checked', obj.use_zimmerman=='1');
  $('#key').val(obj.key);
  $('#location').val(obj.location);
  $('#use_logging').prop('checked', obj.use_logging=='1');
  $('#logging_ip_addr').val(obj.logging_ip_addr);
  $('#logging_ip_port').val(obj.logging_ip_port);
  $('#log_url').val(obj.log_url);
  $('#rainBlackoutMultiplier').val(obj.rainBlackoutMultiplier);
  $('#use_torrent').prop('checked', obj.use_torrent=='1');
  $('#torrent_ip_addr').val(obj.torrent_ip_addr);
  $('#torrent_ip_port').val(obj.torrent_ip_port);
  $('#torrent_delay').val(obj.torrent_delay);
  $('#chip_type').val(obj.chip_type);
}

function initGui() {
  if (/Android|iPhone|iPad|iPod/i.test(navigator.userAgent))
    document.body.style.zoom = '305%';
  else
    document.body.style.zoom = '150%';

  $('#save').button().click(function(event) {
    doSave();
    close();
  });

  $('#ota').button().click(function(event) {
    window.location.href='update.htm';
  });

  $('#spiffs').button().click(function(event) {
    window.location.href='edit.htm';
  });

  $('#reboot').button().click(function(event) {
    var json = {
      command: 'reboot'
    };
    socket.send(JSON.stringify(json)); 
  });

  $('#cancel').button().click(function(event) {
    close();
  });
}

function doSave() {
  var json = {
    command: 'save',
    timeout: $('#timeout').val(),
    water_adjust: $('#water_adjust').val(),
    use_zimmerman: $('#use_zimmerman').is(':checked') ? '1' : '0',
    key: $('#key').val(),
    location: $('#location').val(),
    use_logging: $('#use_logging').is(':checked') ? '1' : '0',
	logging_ip_addr: $('#logging_ip_addr').val(),
	logging_ip_port: $('#logging_ip_port').val(),
	log_url: $('#log_url').val(),
	rainBlackoutMultiplier: $('#rainBlackoutMultiplier').val(),
	use_torrent: $('#use_torrent').is(':checked') ? '1' : '0',
	torrent_ip_addr: $('#torrent_ip_addr').val(),
	torrent_ip_port: $('#torrent_ip_port').val(),
	torrent_delay: $('#torrent_delay').val(),
	chip_type: $('#chip_type').val()
  };
  console.log(JSON.stringify(json));
  socket.send(JSON.stringify(json)); 
}

function close() {
  window.location.href='index.htm';
}
</script>
</head>
<body>
<div id='message' style='zoom:200%;'></div>
<div id='controls'>
  Compiled:<br><label id='date'></label>,<label id='time'></label><br>
  Screen Timeout:<input id='timeout'><br>
  Water Adjust %:<input id='water_adjust'><br>
  <input type='checkbox' id='use_zimmerman'>Use Zimmerman Adjust<br>
  Wunderground Key:<input id='key'><br>
  Wunderground Location:<input id='location'><br>
  <input type='checkbox' id='use_logging'>Use Logging<br>
  Logging IP Address:<input id='logging_ip_addr'><br>
  Logging Port:<input id='logging_ip_port'><br>
  Log URL:<input id='log_url'><br>
  Rain Delay Multiplier:<input id='rainBlackoutMultiplier'><br>
  <input type='checkbox' id='use_torrent'>Pause Torrents<br>
  Transmission IP Address:<input id='torrent_ip_addr'><br>
  Transmission Port:<input id='torrent_ip_port'><br>
  Delay after stop:<input id='torrent_delay'><br>
  Chip Type:<input id='chip_type'><br>
  <br>
  <button id='spiffs'>SPIFFS</button>
  <button id='ota'>OTA Update</button><br><br>
  <!-- <button id='reboot'>Reboot</button><br><br> -->
  <button id='save'>Save</button>
  <button id='cancel'>Cancel</button>
</div>
</body>
</html>